import{l as ee,_ as re,u as ae,r as s,A as se,j as e,n as I}from"./index-15276b8c.js";import{u as P,R as j,C as M,F as w,B as c,L as S,I as te}from"./index-c6893730.js";import{D as ne}from"./Dragger-f1b3a324.js";import{n as u}from"./notification-217e712a.js";import{S as o}from"./index-8cc1215a.js";import{C}from"./index-1c31f4bc.js";import{T as g}from"./index-16b49cf5.js";import{I as T}from"./index-67fd8223.js";import"./DeleteOutlined-cb76da01.js";import"./css-b4695f13.js";const le={getBase64:l=>new Promise((r,f)=>{const i=new FileReader;i.readAsDataURL(l),i.onload=()=>r(i.result),i.onerror=L=>f(L)})},ie={forms:{masterApp:[{label:"App Name",name:"name",required:!0,placeholder:"Example"},{label:"Package Name",name:"package_name",required:!0,placeholder:"com.example.example"},{label:"Version Code",name:"version_code",required:!0,placeholder:"1"},{label:"Version Name",name:"version_name",required:!0,placeholder:"1.1"},{label:"Privacy Policy Link",name:"privacy_policy_link"}],style:[{label:"Color Primary",name:"color_primary",required:!0},{label:"Color Primary Variant",name:"color_primary_variant",required:!0},{label:"Color On Primary",name:"color_on_primary",required:!0}],string:[{label:"Set As Wallpaper",name:"set_as_wallpaper",required:!0},{label:"Home Screen",name:"set_wallpaper_home",required:!0},{label:"Lock Screen",name:"set_wallpaper_lock",required:!0},{label:"Home + Lock Screen",name:"wallpaper_both",required:!0},{label:"Cancel",name:"cancel",required:!0},{label:"Set Wallpaper Success",name:"success_set_wallpaper",required:!0},{label:"Exit Message",name:"exit_message",required:!0},{label:"No Connection Message",name:"no_connection_message",required:!0},{label:"Privacy Policy Text",name:"privacy_policy_text"}]}},oe=ee(()=>re(()=>import("./index-c636018f.js"),["assets/index-c636018f.js","assets/index-15276b8c.js","assets/index-cb6ba15e.css","assets/index-5fd352e3.js","assets/index-c6893730.js","assets/index-16b49cf5.js"])),v="CONFIG",F="STRINGS",A="STYLE",ce=1024*1024*.5,O=l=>l.map((r,f)=>e.jsx(w.Item,{label:r.label,name:r.name,rules:[{required:r.required,message:`${r.label} is Required`}],children:e.jsx(te,{placeholder:r.placeholder,type:r.type||"text"})},f)),{forms:R}=ie,be=()=>{const{id:l}=ae(),{appStore:{app:{data:r,loading:f},fetchApp:i}}=s.useContext(se),[L,k]=s.useState(!1),[N,U]=s.useState(!1),[D,$]=s.useState(!1),[B,J]=s.useState(!1),[H,W]=s.useState(!1),[G,Y]=s.useState(!1),[K,Q]=s.useState(!1),[n,V]=s.useState(),[p]=P(),[d]=P(),[m]=P(),y=s.useMemo(()=>r?{name:r.name,package_name:r.package_name,version_code:r.version_code,version_name:r.version_name}:{},[r]),h=s.useMemo(()=>r?{name:r.name,color_primary:r.color_primary,color_primary_variant:r.color_primary_variant,color_on_primary:r.color_on_primary}:{},[r]),x=s.useMemo(()=>r?JSON.parse(r.strings):{},[r]),_=s.useMemo(()=>r?{[v]:{setter:W,form:p,base:y,setLoading:U,constructObj:()=>({id:r.id,...p.getFieldsValue()})},[A]:{setter:Y,form:d,base:h,setLoading:$,constructObj:()=>({id:r.id,...d.getFieldsValue()})},[F]:{setter:Q,form:m,base:x,setLoading:J,constructObj:()=>({id:r.id,...m.getFieldsValue()})}}:null,[r,y,p,d,m,h,x]),X=s.useMemo(()=>({name:"file",showUploadList:!1,fileList:n!=null&&n.file?[n.file]:[],beforeUpload:async t=>{if(!["image/png","image/jpg","image/jpeg"].includes(t.type))return u.error("App icon should be a png, jpg, or jpeg"),!1;if(t.size>=ce)return u.error("App icon size should be less than 500 KB"),!1;const a=await le.getBase64(t);return V({base64:a,file:t}),!1}}),[n]),b=s.useCallback(t=>{const a=_[t];a&&a.setter(JSON.stringify(a.base)!=JSON.stringify(a.form.getFieldsValue()))},[_]),q=t=>{const a=_[t];a&&(a.form.setFieldsValue(a.base),b(t))},z=async t=>{const a=_[t];if(!a)return;try{await a.form.validateFields()}catch{return}a.setLoading(!0);const{err:E}=await I.put("app",JSON.stringify(a.constructObj()));if(E){u.error(`Error updating app ${a.text}. Message: ${E.message}`),a.setLoading(!1);return}await i(l),a.setter(!1),a.setLoading(!1),u.success(`App ${t.toLowerCase()} updated successfully`)},Z=async()=>{k(!0);const t=new FormData;t.append("icon",n.file),t.append("app_id",l);const{err:a}=await I.put("app/icon",t);if(a){u.error(`Error while updating the app icon, please contact the administrator. Message: ${a.message}`),k(!1);return}V(null),i(l),k(!1),u.success("App icon updated successfully")};return s.useEffect(()=>{i(l)},[i,l]),s.useEffect(()=>{y&&p.setFieldsValue({...y}),h&&d.setFieldsValue({...h}),x&&m.setFieldsValue({...x})},[y,h,x,p,d,m]),f||!r?e.jsx(oe,{}):e.jsxs(j,{justify:"start",gutter:16,align:"top",children:[e.jsx(M,{span:18,children:e.jsxs(o,{size:"large",direction:"vertical",style:{display:"flex"},children:[e.jsx(C,{children:e.jsxs(o,{direction:"vertical",size:"small",style:{display:"flex"},children:[e.jsx(g.Title,{level:4,children:"App Info"}),e.jsx(w,{form:p,labelAlign:"left",labelCol:{span:4},wrapperCol:{span:20},onChange:()=>b(v),children:O(R.masterApp)}),H&&e.jsx(j,{justify:"end",children:e.jsxs(o,{size:"middle",children:[e.jsx(c,{onClick:()=>q(v),children:"Reset"}),e.jsx(c,{type:"primary",onClick:()=>z(v),icon:N&&e.jsx(S,{}),children:"Save"})]})})]})}),e.jsx(C,{children:e.jsxs(o,{direction:"vertical",size:"large",style:{display:"flex"},children:[e.jsx(g.Title,{level:4,children:"Style Setting"}),e.jsx(w,{form:d,labelAlign:"left",labelCol:{span:6},wrapperCol:{span:18},onChange:()=>b(A),children:O(R.style)}),G&&e.jsx(j,{justify:"end",children:e.jsxs(o,{size:"middle",children:[e.jsx(c,{onClick:()=>q(A),children:"Reset"}),e.jsx(c,{type:"primary",onClick:()=>z(A),icon:D&&e.jsx(S,{}),children:"Save"})]})})]})}),r.type!==0&&e.jsx(C,{children:e.jsxs(o,{direction:"vertical",size:"large",style:{display:"flex"},children:[e.jsx(g.Title,{level:4,children:"String Setting"}),e.jsx(w,{form:m,labelAlign:"left",labelCol:{span:6},wrapperCol:{span:18},onChange:()=>b(F),children:O(R.string)}),K&&e.jsx(j,{justify:"end",children:e.jsxs(o,{size:"middle",children:[e.jsx(c,{onClick:()=>q(F),children:"Reset"}),e.jsx(c,{type:"primary",onClick:()=>z(F),icon:B&&e.jsx(S,{}),children:"Save"})]})})]})})]})}),e.jsx(M,{span:6,children:e.jsx(o,{direction:"vertical",size:"large",style:{display:"flex"},children:e.jsx(C,{children:e.jsxs(o,{direction:"vertical",size:"small",style:{display:"flex"},children:[e.jsx(g.Title,{level:4,children:"Logo"}),r.icon_url&&e.jsx(T,{src:r.icon_url}),e.jsx(ne,{...X,children:n!=null&&n.base64?e.jsx(T,{preview:!1,src:n.base64,style:{width:"100%"}}):e.jsxs(e.Fragment,{children:[e.jsx(g,{style:{fontWeight:"bold"},children:"Drag and Drop or Select Your App Icon Here"}),e.jsx(g,{children:"256x256 px is recommended"})]})}),(n==null?void 0:n.base64)&&e.jsx(j,{justify:"end",children:e.jsx(c,{type:"primary",size:"large",style:{width:"100%"},icon:L&&e.jsx(S,{}),onClick:Z,children:"Update Icon"})})]})})})})]})};export{be as default};
